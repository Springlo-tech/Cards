<!DOCTYPE html>
<html>
 <head>
   <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
   <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>
   <script src="https://unpkg.com/aframe-particle-system-component@1.1.0/dist/aframe-particle-system-component.min.js"></script>
</head>
  <body>
  <a-scene
      mindar-image="imageTargetSrc: markers/targets.mind; maxTrack: 1;"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
     >
     <a-camera position="0 0 -5" look-controls="enabled: false"></a-camera>

     <a-entity mindar-image-target="targetIndex: 0" id="target-0">
     <a-entity id="wrap-0"></a-entity>
     </a-entity>

     <a-entity mindar-image-target="targetIndex: 1" id="target-1">
     <a-entity id="wrap-1"></a-entity>
     </a-entity>

   </a-scene>

   <script>
   // Dicionário: qual modelo pertence a cada imagem (targetIndex)
   const modelos = {
   // Inclua o caminho para o arquivo de áudio (Ex: assets/musica_0.mp3)
   0: { src: "models/arvoreNatal.glb", img: "images/fundoVerde.jpg", audio: "musicas/natal.mp3" }, 
   // Inclua o caminho para o arquivo de áudio (Ex: assets/musica_1.mp3)
   1: { src: "models/Presente.glb", img: "images/cartao.jpeg", audio: "musicas/natal.mp3" }, 
   };

   // Configurações base para o plano (2D):
   const planeSettings = {
   width: 1.1, 
   height: 1.5, 
   position: "0 0 0", 
   rotation: "0 0 0", 
   material: "shader: flat; transparent: true; opacity: 1", 
   };

   // Para cada target configuramos lazy loading e o áudio
   Object.keys(modelos).forEach((index) => {
   const target = document.querySelector(`#target-${index}`);
   const wrap = document.querySelector(`#wrap-${index}`);
   // Desestruturação para facilitar o uso das propriedades
   const { src: modelSrc, img: imgSrc, audio: audioSrc } = modelos[index]; 

   target.addEventListener("targetFound", () => {
   // 1. CRIA OS ELEMENTOS SE AINDA NÃO FORAM CARREGADOS
   if (!wrap.hasChildNodes()) {
 
     // CRIA O PLANO DE IMAGEM (2D)
     const plane = document.createElement("a-plane");
     plane.setAttribute("src", `url(${imgSrc})`);
     plane.setAttribute("width", planeSettings.width);
     plane.setAttribute("height", planeSettings.height);
     plane.setAttribute("position", planeSettings.position);
     plane.setAttribute("rotation", planeSettings.rotation);
     plane.setAttribute("material", planeSettings.material);
     plane.setAttribute("id", `plane-${index}`);

     // CRIA O MODELO 3D
     const model = document.createElement("a-gltf-model");
     model.setAttribute("src", `url(${modelSrc})`);
     model.setAttribute("scale", "0.6 0.6 0.2");
     model.setAttribute("position", "0 0.1 0.1"); 
     model.setAttribute("rotation", "0 0 0");
     model.setAttribute("animation-mixer", "clip: *; loop: repeat");
     model.setAttribute("id", `model-${index}`);

     // NOVO: CRIA A ENTIDADE DE SOM
     const soundEntity = document.createElement("a-entity");
     soundEntity.setAttribute("sound", {
       src: `url(${audioSrc})`, // Caminho do áudio
       loop: true,               // Repete o áudio
       autoplay: false,          // Inicia manualmente
       positional: false         // Otimização: som não-espacial
     });
     soundEntity.setAttribute("id", `sound-${index}`);

     // 3. ANEXA TODOS ao container
     wrap.appendChild(plane);
     wrap.appendChild(model);
     wrap.appendChild(soundEntity); // ANEXANDO O SOM
     console.log(`Plano, Modelo e Som do target ${index} carregados.`);
   } 

   // 4. REPRODUZ O SOM E TORNA O WRAP VISÍVEL
   wrap.setAttribute("visible", "true");
   
   // Obtém a referência à entidade de som e inicia a reprodução
   const soundEntity = document.querySelector(`#sound-${index}`);
   if (soundEntity && soundEntity.components.sound) {
     soundEntity.components.sound.playSound(); // Inicia o áudio
   }
 });

   target.addEventListener("targetLost", () => {
   // 5. PAUSA O SOM
   const soundEntity = document.querySelector(`#sound-${index}`);
   if (soundEntity && soundEntity.components.sound) {
     soundEntity.components.sound.pauseSound(); // Pausa o áudio
   }
   
   // 6. ESCONDE O CONTAINER INTEIRO
   wrap.setAttribute("visible", "false");
    });
   });
  </script>
  </body>
</html>