<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
      /* Estilos para o contêiner do AR e do texto */
      body {
        margin: 0;
        overflow: hidden;
      }
      .ar-container {
        position: relative;
        width: 100vw;
        height: 100vh;
      }
      a-scene {
        width: 100% !important;
        height: 100% !important;
      }
      #animatedTextOverlay {
        position: absolute;
        top: 20%; /* Ajuste a posição vertical */
        left: 60%;
        transform: translate(-50%, -50%);
        z-index: 10;
        font-family: monospace; /* Fonte simples e confiável */
        font-size: 2.4rem;
        color: #FFD700;
        visibility: hidden; /* Esconde o texto inicialmente */
      }
      .typewriter h1 {
        overflow: hidden;
        border-right: .15em solid orange;
        white-space: nowrap;
        animation: 
          typing 3.5s steps(12, end) forwards,
          blink-caret .75s step-end infinite;
      }
      @keyframes typing {
        from { width: 0 }
        to { width: 100% }
      }
      @keyframes blink-caret {
        from, to { border-color: transparent }
        50% { border-color: orange; }
      }
    </style>
  </head>
  <body>
    <div class="ar-container">
      <div id="animatedTextOverlay">
        <h1>Feliz Natal!</h1>
      </div>

      <a-scene mindar-image="imageTargetSrc: markers/targets.mind;" 
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">
        
        <a-assets>
          <a-asset-item id="cubeModel" src="models/PapaiNoel.glb"></a-asset-item>
          <img id="fundo" src="models/Arvore.png" crossorigin="anonymous">
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0" id="target">
          <a-gltf-model 
            src="#cubeModel" 
            scale="0.2 0.2 0.2" 
            position="-0.5 -0.22 0.1" 
            rotation="0 0 0"
            animation-mixer="clip: *; loop: repeat">
          </a-gltf-model>

          <a-plane 
            id="arvore"
            src="#fundo"
            position="0 0 -0.1" 
            width="1.3" 
            height="1.3"
            rotation="0 0 0"
            transparent="true"
            material="transparent: true; opacity: 1;"
            scale="0 0 0">
          </a-plane>
        </a-entity>
      </a-scene>
    </div>

    <script>
      const tree = document.querySelector("#arvore");
      const targetEntity = document.querySelector("#target");
      const textOverlay = document.querySelector("#animatedTextOverlay");
      
      targetEntity.addEventListener("targetFound", () => {
        console.log("Alvo encontrado. Reiniciando animações.");

        // Animação da árvore
        tree.setAttribute("scale", "0 0 0");
        tree.setAttribute("animation", "property: scale; to: 1 1 1; delay: 1000; dur: 1000");

        // Animação do texto (agora HTML/CSS)
        setTimeout(() => {
          textOverlay.style.visibility = "visible";
          textOverlay.classList.add("typewriter");
        }, 2000); // Começa junto com a animação da árvore
      });

      targetEntity.addEventListener("targetLost", () => {
        console.log("Alvo perdido. Parando animações.");
        
        // Remove a animação da árvore
        tree.removeAttribute("animation");
        
        // Remove a animação do texto
        textOverlay.style.visibility = "hidden";
        textOverlay.classList.remove("typewriter");
      });
    </script>
  </body>
</html>